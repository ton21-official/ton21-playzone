<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>T21 Play Zone</title>
  <meta name="color-scheme" content="dark light">
  <link rel="icon" href="https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png"/>

  <!-- TON Connect UI (CDN) -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

  <style>
    :root{
      --bg:#0b0f16; --panel:#111724;
      --gold1:#ffdf88; --gold2:#f0cf6d; --txt:#e8ecf7; --muted:#9fb0c3;
      --ok:#25d366; --warn:#f7b733;
      --radius:16px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 700px at 50% -10%, #1b2232 0%, var(--bg) 60%, #080b11 100%) fixed;
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--txt); display:flex; align-items:center; justify-content:center; padding:22px;
    }
    .wrap{ width:min(860px,100%); background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));
      border:1px solid rgba(255,255,255,.06); border-radius:24px; padding:22px; box-shadow:0 12px 48px rgba(0,0,0,.35);}
    .center{text-align:center}
    .logo-aura{width:150px;height:150px;margin:6px auto 0;border-radius:50%;
      background:radial-gradient(circle at 50% 50%, rgba(255,223,136,.5), rgba(255,223,136,0) 60%);display:grid;place-items:center}
    .logo{width:118px;height:118px;border-radius:50%;background:#0e1a2b url("https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png") center/80% no-repeat;
      outline:3px solid rgba(255,223,136,.85);box-shadow:0 0 24px rgba(255,223,136,.55), inset 0 0 20px rgba(255,255,255,.05)}
    h1{margin:8px 0 6px;font-size:34px;letter-spacing:.2px;text-shadow:0 2px 0 rgba(0,0,0,.25)}
    .subtitle{color:var(--muted);margin:0 0 14px}
    .grid10{display:grid;gap:14px;grid-template-columns:repeat(5,1fr);max-width:650px;margin:18px auto}
    @media(max-width:520px){.grid10{grid-template-columns:repeat(3,1fr)}}
    .num{
      border:0;border-radius:14px;padding:18px 0;font-size:22px;font-weight:800;
      background:linear-gradient(180deg,var(--gold1),var(--gold2)); color:#3a2a00;
      box-shadow:0 12px 24px rgba(240,207,109,.25), inset 0 1px 0 rgba(255,255,255,.5);
      transition:transform .06s ease, filter .15s ease; cursor:pointer;
    }
    .num:active{transform:translateY(1px) scale(.99)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
    .pill{border-radius:12px;border:1px solid rgba(255,255,255,.08);padding:8px 12px;background:rgba(255,255,255,.03);cursor:pointer}
    .pill.active{outline:2px solid rgba(255,223,136,.75);background:rgba(255,223,136,.08)}
    .stat{max-width:680px;margin:10px auto 0;color:var(--muted);text-align:center}
    .balance{font-weight:800;color:var(--ok)}
    .panel{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:14px;margin:10px auto;max-width:720px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;border:0;border-radius:14px;
      padding:14px 16px;background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#3a2a00;font-weight:800;
      box-shadow:0 12px 24px rgba(240,207,109,.25), inset 0 1px 0 rgba(255,255,255,.5); cursor:pointer
    }
    .btn.secondary{background:linear-gradient(180deg,#ffd86a,#f2c551)}
    .muted{color:var(--muted)} .sep{height:1px;background:rgba(255,255,255,.06);margin:14px auto;max-width:720px}
    .footer{color:var(--muted);text-align:center;margin-top:8px;font-size:13px}
    .hint{font-size:14px;color:var(--muted)}
    .danger{color:#ff6b6b}
  </style>
</head>
<body>
<main class="wrap">
  <div class="center">
    <div class="logo-aura"><div class="logo"></div></div>
    <h1 id="t_title">T21 Play Zone</h1>
    <p id="t_sub" class="subtitle">Guess a number 1‚Äì10 & win Ton21!</p>
  </div>

  <div class="panel center">
    <div id="ton-connect"></div>
    <div id="wallet-line" class="hint" style="margin-top:8px;"></div>
  </div>

  <section class="grid10" id="grid"></section>

  <div class="stat">
    <div id="balanceLine">üí∞ <span id="t_balance">Your balance</span>:
      <span class="balance"><span id="balance">0</span> Ton21</span></div>
    <div id="playsLine" class="muted" style="margin-top:6px">üéÆ <span id="t_plays">Plays left today</span>: <span id="playsLeft">100</span> / 100</div>
    <div id="capLine" class="muted">üîí <span id="t_cap">Daily win cap</span>: +<span id="capUsed">0</span> / 1000 T21</div>
  </div>

  <div class="panel center" id="resultBox" style="display:none"></div>

  <div class="panel center">
    <div class="row" style="justify-content:center; gap:10px;">
      <button class="btn" id="btnPayout">üí∏ <span id="t_payout">Request Payout</span></button>
      <button class="btn secondary" id="btnPortal">üè† Ton21 Portal</button>
    </div>
    <div class="hint" style="margin-top:10px">
      üíé <span id="t_demo">Demo mode</span>. <span id="t_demo2">Payouts require connected wallet & backend.</span>
    </div>
    <div class="hint" style="margin-top:6px">
      üåï <span id="t_withdraw">Withdraw address</span>:
      <code id="withdrawAddr">UQAqZ3e_Qf1zX3AxcaLyj...KXIskdUs2</code>
    </div>
  </div>

  <div class="sep"></div>

  <div class="row" style="justify-content:center;margin-top:6px">
    <span class="muted" id="t_lang">Language:</span>
    <span class="pill" data-lang="ru">RU</span>
    <span class="pill" data-lang="en">GB</span>
    <span class="pill" data-lang="zh">CN</span>
    <span class="pill" data-lang="hi">IN</span>
  </div>

  <p class="footer">¬© 2025 Ton21 Project ‚Äî All rights reserved</p>
</main>

<script>
  const BACKEND_URL = "https://YOUR-BACKEND.example/payout";
  const WITHDRAW_TON_ADDRESS = "UQAqZ3e_Qf1zX3AxcaLyj...KXIskdUs2";
  const DAILY_PLAYS = 100;
  const DAILY_CAP = 1000;
  const MIN_PRIZE = 1, MAX_PRIZE = 10;
  const DEMO_MODE = true;

  const T = {
    ru:{ title:"T21 Play Zone", sub:"–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10 –∏ –≤—ã–∏–≥—Ä–∞–π Ton21!",
      balance:"–¢–≤–æ–π –±–∞–ª–∞–Ω—Å", plays:"–ò–≥—Ä –æ—Å—Ç–∞–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è", cap:"–õ–∏–º–∏—Ç –≤—ã–∏–≥—Ä—ã—à–∞ –∑–∞ —Å—É—Ç–∫–∏",
      payout:"–ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É", demo:"–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–µ–º–æ-–∏–≥—Ä–∞", demo2:"–î–ª—è –≤—ã–ø–ª–∞—Ç –Ω—É–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª—ë–∫ –∏ backend.",
      withdraw:"–ö–æ—à–µ–ª—ë–∫ –¥–ª—è –≤—ã–≤–æ–¥–∞", lang:"–Ø–∑—ã–∫:" },
    en:{ title:"T21 Play Zone", sub:"Guess a number 1‚Äì10 & win Ton21!",
      balance:"Your balance", plays:"Plays left today", cap:"Daily win cap",
      payout:"Request Payout", demo:"Demo mode", demo2:"Payouts require connected wallet & backend.",
      withdraw:"Withdraw address", lang:"Language:" },
    zh:{ title:"T21 Ê∏∏ÊàèÂå∫", sub:"Áåú 1‚Äì10 ÁöÑÊï∞Â≠óÂπ∂Ëµ¢Âæó Ton21ÔºÅ",
      balance:"‰Ω†ÁöÑ‰ΩôÈ¢ù", plays:"‰ªäÊó•Ââ©‰ΩôÊ¨°Êï∞", cap:"ÊØèÊó•‰∏äÈôê",
      payout:"Áî≥ËØ∑ÊèêÁé∞", demo:"ÊºîÁ§∫Ê®°Âºè", demo2:"ÊèêÁé∞ÈúÄËøûÊé•Èí±ÂåÖÂíåÂêéÂè∞„ÄÇ",
      withdraw:"ÊèêÁé∞Âú∞ÂùÄ", lang:"ËØ≠Ë®ÄÔºö" },
    hi:{ title:"T21 ‡§™‡•ç‡§≤‡•á ‡§ú‡§º‡•ã‡§®", sub:"1‚Äì10 ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç ‡§î‡§∞ Ton21 ‡§ú‡•Ä‡§§‡•á‡§Ç!",
      balance:"‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡§æ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏", plays:"‡§Ü‡§ú ‡§∂‡•á‡§∑ ‡§ö‡§æ‡§≤‡•á‡§Ç", cap:"‡§¶‡•à‡§®‡§ø‡§ï ‡§∏‡•Ä‡§Æ‡§æ",
      payout:"‡§™‡•á‡§Ø‡§Ü‡§â‡§ü ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß", demo:"‡§°‡•á‡§Æ‡•ã ‡§Æ‡•ã‡§°", demo2:"‡§™‡•á‡§Ø‡§Ü‡§â‡§ü ‡§π‡•á‡§§‡•Å ‡§µ‡•â‡§≤‡•á‡§ü ‡§î‡§∞ ‡§¨‡•à‡§ï‡§è‡§Ç‡§° ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡•§",
      withdraw:"‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§™‡§§‡§æ", lang:"‡§≠‡§æ‡§∑‡§æ:" }
  };

  function getLang(){
    const saved = localStorage.getItem("t21_lang");
    if(saved && T[saved]) return saved;
    const sys = (navigator.language||"en").slice(0,2).toLowerCase();
    return T[sys] ? sys : "en";
  }

  let LANG = getLang();
  function applyTexts(){
    const t=T[LANG];
    document.getElementById("t_title").textContent=t.title;
    document.getElementById("t_sub").textContent=t.sub;
    document.getElementById("t_balance").textContent=t.balance;
    document.getElementById("t_plays").textContent=t.plays;
    document.getElementById("t_cap").textContent=t.cap;
    document.getElementById("t_payout").textContent=t.payout;
    document.getElementById("t_demo").textContent=t.demo;
    document.getElementById("t_demo2").textContent=t.demo2;
    document.getElementById("t_withdraw").textContent=t.withdraw;
    document.getElementById("t_lang").textContent=t.lang;
    document.querySelectorAll(".pill").forEach(p=>p.classList.toggle("active", p.dataset.lang===LANG));
  }
  function setLang(code){ if(!T[code])return; LANG=code; localStorage.setItem("t21_lang",LANG); applyTexts(); }

  let tonUI, connectedAddress=null;
  async function initTonConnect(){
    try{
      tonUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: location.origin + location.pathname.replace(/\/[^\/]*$/, '') + '/tonconnect-manifest.json',
        buttonRootId: "ton-connect"
      });
      tonUI.onStatusChange(wallet=>{
        connectedAddress = wallet?.account?.address || null;
        document.getElementById("wallet-line").textContent =
          connectedAddress ? `‚úÖ ${connectedAddress}` : "";
      });
    }catch(e){ console.warn("TON Connect init failed", e); }
  }

  const KEY="t21_playzone_v4";
  function todayKey(){ const d=new Date(); return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; }
  function loadState(){
    const s = JSON.parse(localStorage.getItem(KEY)||"{}");
    const day = todayKey();
    if(s.day!==day) return {day, balance:0, plays:DAILY_PLAYS, capUsed:0};
    return {...{day, balance:0, plays:DAILY_PLAYS, capUsed:0}, ...s};
  }
  function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); refreshUI(); }
  let state = loadState();

  function tgOpen(url){
    try{ if(window.Telegram?.WebApp){ window.Telegram.WebApp.openLink(url); return; } }catch(e){}
    window.open(url,"_blank","noopener");
  }

  function refreshUI(){
    document.getElementById("balance").textContent = state.balance;
    document.getElementById("playsLeft").textContent = state.plays;
    document.getElementById("capUsed").textContent = state.capUsed;
    document.getElementById("withdrawAddr").textContent = WITHDRAW_TON_ADDRESS;
  }

  function weightedPrize(){
    const weights = {1:18,2:16,3:14,4:12,5:10,6:8,7:7,8:6,9:5,10:4};
    let r = Math.floor(Math.random()*100)+1, acc=0;
    for(let p=1; p<=10; p++){ acc+=weights[p]; if(r<=acc) return p; }
    return 1;
  }

  function play(n){
    const out = document.getElementById("resultBox");
    if(state.plays<=0){ out.style.display="block"; out.innerHTML = `<span class="danger">‚õî Limit reached</span>`; return; }
    if(state.capUsed>=DAILY_CAP){ out.style.display="block"; out.innerHTML = `<span class="danger">üîí Cap reached</span>`; return; }

    const hidden = Math.floor(Math.random()*10)+1;
    if(n===hidden){
      let prize = weightedPrize();
      if(state.capUsed + prize > DAILY_CAP) prize = Math.max(0, DAILY_CAP - state.capUsed);
      state.balance += prize;
      state.capUsed += prize;
      out.innerHTML = `üéâ <b>Guessed ${hidden}!</b> +${prize} T21`;
    }else{
      out.innerHTML = `üôÇ Missed. It was <b>${hidden}</b>`;
    }
    state.plays -= 1;
    out.style.display = "block";
    saveState();
  }

  async function requestPayout(){
    if(!connectedAddress){ alert("Connect wallet first."); return; }
    if(state.balance<=0){ alert("Balance is zero."); return; }
    try{
      const res = await fetch(BACKEND_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ address: connectedAddress, amount: state.balance, source:"t21-playzone" })
      });
      if(!res.ok) throw new Error("Server error");
      alert("‚úÖ Request sent! Wait for credit.");
      state.balance = 0; saveState();
    }catch(e){
      console.error(e);
      alert("‚ùó Connection error. Check BACKEND_URL.");
    }
  }

  function buildGrid(){
    const grid=document.getElementById("grid");
    grid.innerHTML="";
    for(let i=1;i<=10;i++){
      const b=document.createElement("button");
      b.className="num"; b.textContent=i;
      b.addEventListener("click", ()=>play(i));
      grid.appendChild(b);
    }
  }

  (function init(){
    try{ window.Telegram?.WebApp?.expand(); }catch(e){}
    applyTexts();
    document.querySelectorAll(".pill").forEach(p=>p.addEventListener("click", ()=>setLang(p.dataset.lang)));
    buildGrid(); refreshUI();
    document.getElementById("btnPortal").addEventListener("click", ()=>tgOpen("https://t.me/Ton21PortalBot"));
    document.getElementById("btnPayout").addEventListener("click", requestPayout);
    initTonConnect();
  })();
</script>
</body>
</html>
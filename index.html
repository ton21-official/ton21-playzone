<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>T21 Play Zone â€” Mining</title>
  <meta name="color-scheme" content="dark light">
  <link rel="icon" href="https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png"/>

  <!-- (Optional) TonPlay SDK -->
  <!-- <script src="https://sdk.tonplay.io/sdk.js"></script> -->

  <!-- GameMonetize HTML5 SDK -->
  <script type="text/javascript">
    window.SDK_OPTIONS = {
      gameId: "s1mkppmusp8ukxo9citp0uh39ckv28nk",
      onEvent: function (a) {
        switch (a.name) {
          case "SDK_GAME_PAUSE": break;
          case "SDK_GAME_START": break;
          case "SDK_READY":
            console.log("GameMonetize SDK READY");
            break;
        }
      }
    };
    (function (a, b, c) {
      var d = a.getElementsByTagName(b)[0];
      a.getElementById(c) ||
      (a = a.createElement(b),
        a.id = c,
        a.src = "https://api.gamemonetize.com/sdk.js",
        d.parentNode.insertBefore(a, d));
    })(document, "script", "gamemonetize-sdk");
  </script>

  <style>
    :root{
      --bg:#050814;
      --panel:#0f1524;
      --panel2:#0b1020;
      --border:#1e2942;
      --txt:#e9f0ff;
      --muted:#9fb0c3;
      --accent:#46b2ff;
      --green:#35d49b;
      --orange:#ffb458;
      --red:#ff5c7a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 50% -10%, #1b2232 0%, #050814 60%),
        radial-gradient(800px 500px at 120% 110%, #132033 0%, transparent 60%);
      color:var(--txt);
      font:16px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    }
    .wrap{max-width:960px;margin:0 auto;padding:16px 14px 32px;}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:32px;height:32px;border-radius:999px;
      background:#02040a url("https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png") center/cover no-repeat;
      box-shadow:0 0 18px rgba(70,178,255,.6);
    }
    .brand-title{display:flex;flex-direction:column}
    .brand-title span:first-child{font-weight:700;font-size:17px}
    .brand-title span:last-child{font-size:12px;color:var(--muted)}
    .topbar{display:flex;gap:8px;align-items:center}
    .topbar .pill-mini{
      border:1px solid #253354;
      background:#0b1326;
      color:var(--txt);
      padding:8px 12px;
      border-radius:999px;
      font-size:13px;
    }

    .card{
      background:linear-gradient(180deg,#11172a 0%, #090f20 100%);
      border-radius:18px;
      border:1px solid #1e2942;
      padding:16px 14px 18px;
      box-shadow:0 18px 40px rgba(0,0,0,.6);
    }
    .title-main{text-align:center;margin:0 0 10px;font-weight:700;font-size:18px}
    .subtitle{text-align:center;margin:0 0 16px;font-size:13px;color:var(--muted)}

    .balance-box{
      text-align:center;
      padding:10px 8px 14px;
      border-radius:14px;
      background:radial-gradient(circle at 50% 0,#1e2740 0, #0b1020 55%);
      border:1px solid #222c48;
      margin-bottom:14px;
    }
    .balance-label{font-size:13px;color:var(--muted);margin-bottom:4px}
    .balance-value{font-size:28px;font-weight:800;letter-spacing:0.03em}

    .grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-bottom:14px}
    .pill{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid #1e2942;
      background:#0b1224;
      font-size:12px;
    }
    .pill-label{color:var(--muted);margin-bottom:4px}
    .pill-value{font-weight:600}

    .btn{
      width:100%;
      border-radius:999px;
      border:none;
      padding:12px 16px;
      font-size:15px;
      font-weight:700;
      cursor:pointer;
      margin-bottom:8px;
      transition:transform .05s ease, box-shadow .05s ease, opacity .2s;
    }
    .btn:active{transform:translateY(1px);box-shadow:none}
    .btn[disabled]{opacity:.55;cursor:default}
    .btn-main{
      background:linear-gradient(90deg,#20c6ff,#6af0c4);
      color:#031018;
      box-shadow:0 10px 26px rgba(65,199,255,.4);
    }
    .btn-ad{
      background:linear-gradient(90deg,#ffb458,#ff7e5a);
      color:#1a0700;
      box-shadow:0 10px 26px rgba(255,168,82,.42);
    }
    .btn-secondary{
      background:transparent;
      color:var(--accent);
      border:1px solid #274066;
    }
    .btn-link{
      font-size:14px;
      font-weight:600;
    }
    .btn-link-telegram{
      background:linear-gradient(90deg,#2aabee,#4ad0ff);
      color:#021018;
      box-shadow:0 8px 20px rgba(42,171,238,.45);
    }
    .btn-link-partners{
      background:linear-gradient(90deg,#ffd35a,#ff9f3c);
      color:#2a1300;
      box-shadow:0 8px 20px rgba(255,190,90,.45);
    }

    .hint{font-size:12px;color:var(--muted);text-align:center;margin-bottom:10px;}

    .section{
      margin-top:16px;
      padding:12px 10px;
      border-radius:14px;
      background:var(--panel2);
      border:1px solid #1a2440;
    }
    .section h3{
      margin:0 0 8px;
      font-size:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .section p{margin:4px 0;font-size:13px;color:var(--muted);}

    .wallet-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #273553;
      background:#050a18;
      color:var(--txt); /* FIXED */
      font-size:13px;
      margin-bottom:8px;
    }
    .wallet-note{font-size:11px;color:var(--muted);margin-bottom:6px;}
    .info-small{font-size:11px;color:var(--muted);}

    .row-inline{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .row-inline .btn{margin-bottom:0;}
    .links-row{margin-top:4px;}
    .links-row .btn{flex:1;min-width:140px;}

    .timer-text{font-size:12px;color:var(--muted);text-align:center;margin-bottom:6px;}
    .tag{
      display:inline-flex;align-items:center;gap:4px;
      padding:2px 8px;border-radius:999px;
      font-size:11px;border:1px solid #28436a;color:var(--muted);
    }

    .footer{
      margin-top:14px;
      text-align:center;
      font-size:11px;
      color:var(--muted);
    }

    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.65);
      z-index:50;
    }
    .modal-box{
      width:min(420px,92vw);
      background:#0a1020;
      border-radius:16px;
      border:1px solid #283759;
      padding:16px 14px;
    }
    .modal-title{margin:0 0 6px;font-size:15px;font-weight:600;}
    .modal-text{margin:0 0 12px;font-size:13px;color:var(--muted);}
    .progress{
      height:10px;border-radius:999px;
      background:#050814;
      border:1px solid #1f2c49;
      overflow:hidden;
      margin-bottom:10px;
    }
    .progress>i{
      display:block;height:100%;
      width:0;
      background:linear-gradient(90deg,#20c6ff,#6af0c4);
      transition:width 1s linear;
    }
    .modal-actions{display:flex;gap:8px;margin-top:6px;}
    .modal-actions .btn{flex:1;margin-bottom:0;font-size:14px;}

    .flash{
      position:fixed;
      top:14px;left:50%;
      transform:translateX(-50%);
      background:#101a30;
      border-radius:12px;
      border:1px solid #274066;
      color:#cbe6ff;
      padding:7px 14px;
      font-size:13px;
      display:none;
      z-index:60;
    }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div class="brand-title">
        <span>Ton21 Mining</span>
        <span>Early access to T21 mining</span>
      </div>
    </div>
    <div class="topbar">
      <div class="pill-mini">EN</div>
    </div>
  </header>

  <div class="card">
    <h2 class="title-main">T21 Play Zone â€” Mining</h2>
    <div class="subtitle">
      This is the early mining phase for T21. Your balance is off-chain now, but will be counted for future rewards.
    </div>

    <div class="balance-box">
      <div class="balance-label">Your balance</div>
      <div class="balance-value"><span id="balanceValue">0</span> T21</div>
    </div>

    <div class="grid2">
      <div class="pill">
        <div class="pill-label">Mining speed</div>
        <div class="pill-value">+20 T21 / day</div>
      </div>
      <div class="pill">
        <div class="pill-label">Ad boost</div>
        <div class="pill-value">+5 T21 / ad â€¢ up to 10 per day</div>
      </div>
    </div>

    <div class="hint">
      <span class="tag">Early mining phase</span>
      <span> Planned first payout wave: Marchâ€“April 2026.</span>
    </div>

    <button class="btn btn-main" id="mineBtn">â–¶ Claim daily +20 T21</button>
    <div class="timer-text" id="mineTimer">Daily bonus is available now.</div>

    <button class="btn btn-ad" id="adBtn">ðŸŽ¬ Watch ad (+5 T21)</button>
    <div class="timer-text" id="adInfo">Ad bonus: 0 / 10 used today</div>

    <div class="section">
      <h3><span>Your TON address (future payouts)</span></h3>
      <p>This is an early mining phase. Later you will be able to receive real T21 to your TON address.</p>
      <p class="info-small">
        We save the address to know how much each user mined when payouts start. First planned wave: Marchâ€“April 2026.
      </p>
      <input id="walletInput" class="wallet-input" placeholder="EQ... / UQ..." autocomplete="off"/>
      <div class="wallet-note">Address is stored locally in this browser and can be synced with Ton21 backend.</div>
      <button class="btn btn-secondary" id="saveWalletBtn">Save address</button>
    </div>

    <div class="section">
      <h3>Links</h3>
      <div class="row-inline links-row">
        <button class="btn btn-link btn-link-telegram" id="tgBtn">Telegram</button>
        <button class="btn btn-link btn-link-partners" id="partnersBtn">Partners</button>
      </div>
    </div>

    <div class="section">
      <h3><span>Invite & Share</span></h3>
      <p>Share the mining app with friends. The more active miners we have now, the stronger the Ton21 ecosystem becomes at launch.</p>

      <div class="row-inline" style="margin-top:8px;">
        <button class="btn btn-secondary" id="notifyBtn">ðŸ”” Enable notifications</button>
        <button class="btn btn-secondary" id="shareBtn">ðŸ”— Share Ton21 Mining</button>
      </div>
      <p class="info-small" id="notifyStatus" style="margin-top:6px;"></p>
    </div>

    <div class="footer">
      Powered by Ton21 Project â€¢ v0.3 Early Mining Phase â€¢ Balance stored locally + synced with backend
    </div>
  </div>
</div>

<div class="flash" id="flash"></div>

<!-- Fake Ad modal (fallback) -->
<div class="modal" id="adModal">
  <div class="modal-box">
    <h3 class="modal-title" id="adModalTitle">Sponsored video</h3>
    <p class="modal-text" id="adModalText">Please wait 30 seconds to receive your bonus.</p>
    <div class="progress"><i id="adBar"></i></div>
    <div class="timer-text" id="adCountdownText">00:30</div>
    <div class="modal-actions">
      <button class="btn btn-secondary" id="adCloseBtn" disabled>Close</button>
      <button class="btn btn-main" id="adClaimBtn" disabled>Get reward</button>
    </div>
  </div>
</div>

<script>
  // Settings
  var DAILY_REWARD = 20;
  var AD_REWARD = 5;
  var MAX_ADS_PER_DAY = 10;
  var AD_SECONDS = 30;
  var DAY_MS = 24 * 60 * 60 * 1000;

  // Backend
  const API = "https://t21-playzone-api.t21playzone.workers.dev";
  const USER_ID_KEY = "t21m_userId";

  // Notifications
  const NOTIFY_KEY = "t21m_lastNotify";
  const NOTIFY_ENABLED_KEY = "t21m_notifyEnabled";

  // Unique user id
  var userId = localStorage.getItem(USER_ID_KEY);
  if (!userId) {
    try {
      userId = (window.crypto && crypto.randomUUID) ? crypto.randomUUID() : ("u_" + Date.now() + "_" + Math.floor(Math.random() * 1e9));
    } catch(e){
      userId = "u_" + Date.now() + "_" + Math.floor(Math.random() * 1e9);
    }
    localStorage.setItem(USER_ID_KEY, userId);
  }

  // State
  var balance = Number(localStorage.getItem("t21m_balance") || "0");
  var lastMine = Number(localStorage.getItem("t21m_lastMine") || "0");
  var wallet = localStorage.getItem("t21m_wallet") || "";
  var adsDate = localStorage.getItem("t21m_adsDate") || "";
  var adsUsed = Number(localStorage.getItem("t21m_adsUsed") || "0");

  // DOM
  var $ = function(id){return document.getElementById(id);};
  var balanceValue = $("balanceValue");
  var mineBtn = $("mineBtn");
  var mineTimer = $("mineTimer");
  var adBtn = $("adBtn");
  var adInfo = $("adInfo");
  var walletInput = $("walletInput");
  var saveWalletBtn = $("saveWalletBtn");
  var shareBtn = $("shareBtn");
  var flash = $("flash");

  var adModal = $("adModal");
  var adBar = $("adBar");
  var adCountdownText = $("adCountdownText");
  var adCloseBtn = $("adCloseBtn");
  var adClaimBtn = $("adClaimBtn");

  var tgBtn = $("tgBtn");
  var partnersBtn = $("partnersBtn");

  var notifyBtn = $("notifyBtn");
  var notifyStatus = $("notifyStatus");

  var adTimer = null;

  // Backend helpers
  async function apiGetUser(){
    try{
      const res = await fetch(API + "/user?id=" + encodeURIComponent(userId));
      if(!res.ok) return null;
      return await res.json();
    }catch(e){
      return null;
    }
  }

  async function apiSaveAddress(addr){
    try{
      await fetch(API + "/save_address", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ id:userId, address:addr })
      });
    }catch(e){}
  }

  async function apiAddMining(){
    try{
      await fetch(API + "/add_mining", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ id:userId, amount:DAILY_REWARD })
      });
    }catch(e){}
  }

  async function apiAddAdReward(){
    try{
      const res = await fetch(API + "/add_ad_reward", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ id:userId, amount:AD_REWARD })
      });
      if(res.ok){
        const data = await res.json().catch(()=>null);
        if(data && typeof data.balance === "number") balance = data.balance;
        if(data && typeof data.adsToday === "number"){
          adsUsed = data.adsToday;
          adsDate = todayKey();
        }
        saveState();
        updateBalanceUI();
        updateAdInfo();
      }
    }catch(e){}
  }

  async function syncFromServer(){
    const data = await apiGetUser();
    if(!data) return;
    if(typeof data.balance === "number") balance = data.balance;
    if(typeof data.lastMining === "number") lastMine = data.lastMining;
    if(data.address){
      wallet = data.address;
      if(walletInput) walletInput.value = wallet;
    }
    if(typeof data.adsToday === "number" && data.lastAdDay){
      adsUsed = data.adsToday;
      adsDate = data.lastAdDay;
    }
    saveState();
    updateBalanceUI();
    updateAdInfo();
    updateMineUI();
  }

  // Helpers
  function todayKey(){
    return (new Date()).toISOString().slice(0,10);
  }

  function ensureAdDay(){
    var today = todayKey();
    if(adsDate !== today){
      adsDate = today;
      adsUsed = 0;
      localStorage.setItem("t21m_adsDate", adsDate);
      localStorage.setItem("t21m_adsUsed", String(adsUsed));
    }
  }

  function fmt2(n){return n<10?"0"+n:String(n);}

  function humanLeft(ms){
    if(ms <= 0) return "00:00:00";
    var s = Math.floor(ms/1000);
    var h = Math.floor(s/3600); s-=h*3600;
    var m = Math.floor(s/60); s-=m*60;
    return fmt2(h)+":"+fmt2(m)+":"+fmt2(s);
  }

  function flashMsg(text, ms){
    if(ms === undefined) ms = 1800;
    flash.textContent = text;
    flash.style.display = "block";
    setTimeout(function(){ flash.style.display="none"; }, ms);
  }

  function saveState(){
    localStorage.setItem("t21m_balance", String(balance));
    localStorage.setItem("t21m_lastMine", String(lastMine));
    localStorage.setItem("t21m_wallet", wallet);
    localStorage.setItem("t21m_adsDate", adsDate);
    localStorage.setItem("t21m_adsUsed", String(adsUsed));
  }

  function isValidTon(a){
    a = (a || "").trim();
    return /^EQ/.test(a) || /^UQ/.test(a);
  }

  // UI updates
  function updateBalanceUI(){
    balanceValue.textContent = balance.toFixed(2).replace(/\.00$/,"");
  }

  function updateAdInfo(){
    ensureAdDay();
    adInfo.textContent = "Ad bonus: " + adsUsed + " / " + MAX_ADS_PER_DAY + " used today";
    adBtn.disabled = adsUsed >= MAX_ADS_PER_DAY;
  }

  function updateMineUI(){
    var now = Date.now();
    var left = lastMine ? (lastMine + DAY_MS - now) : -1;
    if(!lastMine || left <= 0){
      mineBtn.disabled = false;
      mineTimer.textContent = "Daily bonus is available now.";
    }else{
      mineBtn.disabled = true;
      mineTimer.textContent = "Next daily bonus in " + humanLeft(left);
    }
  }

  setInterval(updateMineUI, 1000);

  // Notifications (permission only by user click)
  function notificationsSupported(){
    return ("Notification" in window);
  }

  function getNotifyEnabled(){
    return localStorage.getItem(NOTIFY_ENABLED_KEY) === "1";
  }

  function setNotifyEnabled(v){
    localStorage.setItem(NOTIFY_ENABLED_KEY, v ? "1" : "0");
  }

  function updateNotifyUI(){
    if(!notifyBtn || !notifyStatus) return;

    if(!notificationsSupported()){
      notifyBtn.disabled = true;
      notifyBtn.textContent = "ðŸ”” Notifications not supported";
      notifyStatus.textContent = "Your browser does not support notifications.";
      return;
    }

    const enabled = getNotifyEnabled();
    const perm = Notification.permission;

    if(enabled && perm === "granted"){
      notifyBtn.textContent = "ðŸ”” Notifications enabled";
      notifyBtn.disabled = true;
      notifyStatus.textContent = "We will remind you once per day to come back and claim your bonus.";
    } else if(perm === "denied"){
      notifyBtn.textContent = "ðŸ”” Notifications blocked";
      notifyBtn.disabled = true;
      notifyStatus.textContent = "Notifications are blocked in browser settings. Allow them manually to enable.";
    } else {
      notifyBtn.textContent = "ðŸ”” Enable notifications";
      notifyBtn.disabled = false;
      notifyStatus.textContent = "Enable to receive one reminder per day to come back and claim the bonus.";
    }
  }

  async function enableNotifications(){
    if(!notificationsSupported()) return;

    try{
      const perm = await Notification.requestPermission();
      if(perm === "granted"){
        setNotifyEnabled(true);
        localStorage.setItem(NOTIFY_KEY, String(Date.now()));
        new Notification("T21 Mining", {
          body: "Notifications enabled! We'll remind you once per day.",
          icon: "https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png"
        });
      } else {
        setNotifyEnabled(false);
      }
    }catch(e){
      setNotifyEnabled(false);
    }
    updateNotifyUI();
  }

  function showDailyNotificationIfNeeded(){
    if(!notificationsSupported()) return;
    if(!getNotifyEnabled()) return;
    if(Notification.permission !== "granted") return;

    var last = Number(localStorage.getItem(NOTIFY_KEY) || "0");
    var now = Date.now();

    if(!last || now - last >= DAY_MS){
      new Notification("T21 Mining", {
        body: "Your daily +20 T21 bonus may be ready. Come back and claim it!",
        icon: "https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png"
      });
      localStorage.setItem(NOTIFY_KEY, String(now));
    }
  }

  // Rewards
  function rewardDaily(){
    var now = Date.now();
    var left = lastMine ? (lastMine + DAY_MS - now) : -1;
    if(lastMine && left > 0){
      updateMineUI();
      return;
    }
    lastMine = now;
    balance += DAILY_REWARD;
    saveState();
    updateBalanceUI();
    updateMineUI();
    flashMsg("+20 T21 added to your balance.", 2200);
    apiAddMining();
  }

  function rewardAd(){
    ensureAdDay();
    if(adsUsed >= MAX_ADS_PER_DAY){
      updateAdInfo();
      return;
    }
    adsUsed += 1;
    balance += AD_REWARD;
    saveState();
    updateBalanceUI();
    updateAdInfo();
    flashMsg("+5 T21 added for watching the ad.", 2000);
    apiAddAdReward();
  }

  // Fake ad flow (fallback)
  function startAdFlow(){
    ensureAdDay();
    if(adsUsed >= MAX_ADS_PER_DAY){
      flashMsg("Daily ad limit reached (10 / 10).", 2000);
      return;
    }

    adBar.style.width = "0%";
    adCountdownText.textContent = "00:"+fmt2(AD_SECONDS);
    adCloseBtn.disabled = true;
    adClaimBtn.disabled = true;

    adModal.style.display = "flex";
    flashMsg("Ad started â€” please wait 30 secondsâ€¦", 1600);

    var elapsed = 0;
    if(adTimer){ clearInterval(adTimer); }
    adTimer = setInterval(function(){
      elapsed += 1;
      var left = AD_SECONDS - elapsed;
      if(left < 0) left = 0;
      adCountdownText.textContent = "00:"+fmt2(left);
      var pct = Math.min(100, Math.floor(elapsed / AD_SECONDS * 100));
      adBar.style.width = pct + "%";

      if(elapsed >= AD_SECONDS){
        clearInterval(adTimer);
        adTimer = null;
        adClaimBtn.disabled = false;
        adCloseBtn.disabled = false;
      }
    }, 1000);
  }

  function closeAdModal(){
    adModal.style.display = "none";
    if(adTimer){ clearInterval(adTimer); adTimer = null; }
  }

  function finishAdReward(){
    closeAdModal();
    rewardAd();
  }

  // Wrapper for external ads + fallback
  function startAd(){
    try{
      if (typeof window.sdk !== "undefined" && typeof window.sdk.showBanner !== "undefined") {
        window.sdk.showBanner();
      } else {
        console.log("GameMonetize sdk not ready yet");
      }
    }catch(e){
      console.warn("GameMonetize error:", e);
    }

    if (window.TonPlay && typeof TonPlay.showRewardedAd === "function") {
      flashMsg("Ad started â€” please wait 30 secondsâ€¦", 1600);
      try{
        TonPlay.showRewardedAd()
          .then(function(){ rewardAd(); })
          .catch(function(){ startAdFlow(); });
      }catch(e){
        startAdFlow();
      }
    } else {
      startAdFlow();
    }
  }

  // Events
  walletInput.value = wallet;

  saveWalletBtn.addEventListener("click", function(){
    var v = walletInput.value.trim();
    if(!isValidTon(v)){
      flashMsg("âš ï¸ Enter a valid TON address (starts with EQ or UQ).", 2200);
      return;
    }
    wallet = v;
    saveState();
    apiSaveAddress(wallet);
    flashMsg("âœ… Address saved", 1800);
  });

  mineBtn.addEventListener("click", rewardDaily);
  adBtn.addEventListener("click", startAd);
  adCloseBtn.addEventListener("click", closeAdModal);
  adClaimBtn.addEventListener("click", finishAdReward);

  tgBtn.addEventListener("click", function(){
    window.open("https://t.me/Ton21_Army", "_blank");
  });

  partnersBtn.addEventListener("click", function(){
    window.open("https://tonplay.fo/hUWcgtAr3L3x3W?click_id=%7Bclick_id%7D", "_blank");
  });

  shareBtn.addEventListener("click", function(){
    const cleanUrl = "https://ton21-official.github.io/ton21-playzone/";
    const shareData = {
      title: "T21 Play Zone â€” Mining",
      text: "Join T21 Mining â€” early access before payouts in 2026!",
      url: cleanUrl
    };

    if (navigator.share) {
      navigator.share(shareData).catch(()=>{});
      return;
    }

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(cleanUrl)
        .then(()=> flashMsg("ðŸ”— Link copied", 1800))
        .catch(()=> flashMsg("If sharing does not open, copy the link manually.", 1800));
      return;
    }

    flashMsg("If sharing does not open, copy the link manually.", 1800);
  });

  if(notifyBtn){
    notifyBtn.addEventListener("click", enableNotifications);
  }

  // Init
  function init(){
    ensureAdDay();
    updateBalanceUI();
    updateAdInfo();
    updateMineUI();
    updateNotifyUI();
    syncFromServer();

    // show daily notification only if user enabled it earlier
    showDailyNotificationIfNeeded();

    document.addEventListener("visibilitychange", function(){
      if(!document.hidden){
        showDailyNotificationIfNeeded();
      }
    });
  }

  init();
</script>
</body>
</html>

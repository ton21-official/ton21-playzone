<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>T21 Play Zone</title>
<meta name="color-scheme" content="dark light">
<link rel="icon" href="https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png"/>

<!-- TonPlay SDK (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ø–æ–∫–∞–∂–µ–º rewarded ad; –∏–Ω–∞—á–µ –±—É–¥–µ—Ç —Ñ–æ–ª–±–µ–∫-—Å–∏–º—É–ª—è—Ü–∏—è) -->
<script src="https://sdk.tonplay.io/sdk.js"></script>

<style>
  :root{
    --bg:#0b0f16; --panel:#121827; --muted:#9fb0c3;
    --gold1:#ffdf88; --gold2:#f0cf6d; --txt:#e8ecf7; --accent:#3cc8ff;
    --button-shadow:0 8px 20px rgba(240,207,109,.25);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:
      radial-gradient(1200px 700px at 50% -10%, #1b2232 0%, #0b0f16 60%),
      radial-gradient(800px 500px at 120% 110%, #132033 0%, transparent 60%);
    color:var(--txt);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial
  }
  .wrap{max-width:960px;margin:24px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand-emoji{font-size:26px}
  .brand h1{font-size:20px;margin:0}
  .topbar{display:flex;gap:8px;align-items:center}
  select{appearance:none;background:#0f1a2c;border:1px solid #223150;color:var(--txt);
         padding:10px 28px 10px 12px;border-radius:10px}

  .card{background:linear-gradient(180deg,#0f1524 0%, #0c1220 100%);
        border:1px solid #1c2742;border-radius:16px;padding:18px}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
  .pill{flex:1;min-width:160px;background:#0f1a2c;border:1px solid #1e2a45;color:var(--txt);
        border-radius:12px;padding:12px 14px;font-weight:600}
  .muted{color:var(--muted);font-weight:500}
  input[type=text]{width:100%;padding:14px 16px;border-radius:12px;border:1px solid #273553;background:#0f1a2c;color:var(--txt)}
  .btn{display:block;width:100%;padding:14px 18px;border-radius:12px;border:0;cursor:pointer;
       background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#2b1f06;font-weight:800;
       box-shadow:var(--button-shadow);transition:transform .06s ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.secondary{background:transparent;color:var(--gold1);border:1px solid var(--gold2)}
  .btn.disabled,.btn:disabled{opacity:.5;pointer-events:none}

  .section{margin-top:18px}
  .title{font-weight:800;margin:0 0 10px}
  .keys{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
  .key{padding:14px;border-radius:12px;background:#0f1a2c;border:1px solid #1e2a45;
       font-size:20px;font-weight:800;cursor:pointer;text-align:center}
  .key:active{transform:scale(.98)}
  .footer{margin-top:22px;text-align:center;color:#7fa7c8;font-size:13px}

  /* flash toast */
  .flash{position:fixed;top:18px;left:50%;transform:translateX(-50%);
         background:#122033;border:1px solid #274060;color:#bfe5ff;
         padding:10px 14px;border-radius:10px;display:none;z-index:30}

  /* promo/ad modal (fallback) */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:40}
  .modal .box{width:min(520px,92vw);background:#0f1a2c;border:1px solid #243354;border-radius:16px;padding:18px}
  .progress{height:10px;background:#0c1220;border:1px solid #23324f;border-radius:999px;overflow:hidden}
  .progress>i{display:block;height:100%;background:linear-gradient(90deg,#36c3ff,#8fe3ff);width:0%}
  .row-split{display:flex;gap:12px}
  .row-split .btn{flex:1}

  /* status bar */
  .status{margin:-6px 0 8px;color:#ffc38a}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="brand-emoji">üíé</div>
      <h1>T21 Play Zone</h1>
    </div>
    <div class="topbar">
      <span>üåê</span>
      <select id="langSel" title="Language">
        <option value="en">EN</option>
        <option value="ru" selected>RU</option>
        <option value="cn">‰∏≠Êñá</option>
        <option value="in">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="am">’Ä’°’µ</option>
      </select>
    </div>
  </header>

  <div class="card">
    <div id="status" class="status"></div>

    <div class="row">
      <div class="pill" id="balanceBox">Balance: 0 T21</div>
      <div class="pill" id="playsBox">Plays left: 100</div>
    </div>

    <div class="section">
      <label class="muted" id="enterLbl">Enter your TON address</label>
      <input id="wallet" type="text" placeholder="EQ... / UQ..." autocomplete="off"/>
      <div class="muted" id="saveNote"></div>

      <div class="row">
        <button class="btn" id="saveBtn">Save Wallet</button>
      </div>

      <div class="row">
        <button class="btn" id="claimBtn">üí∞ Claim Reward</button>
      </div>

      <div class="row">
        <button class="btn" id="adBtn">üé¨ Watch Ad (+10 plays)</button>
      </div>

      <div class="row">
        <button class="btn secondary" id="shareBtn">ü§ù Share (+5 T21)</button>
      </div>

      <div class="row">
        <button class="btn secondary" id="withdrawBtn">üí∏ Withdraw T21</button>
      </div>

      <div class="section">
        <h3 class="title" id="guessTitle">üéØ Guess 1‚Äì9</h3>
        <div class="muted" id="hintNote"></div>
        <div class="keys" id="keys"></div>
      </div>
    </div>
  </div>

  <div class="footer" id="footerNote">Powered by <b>Ton21 Project</b> ‚ö°</div>
</div>

<!-- flash -->
<div class="flash" id="flash"></div>

<!-- Fallback Ad modal (–µ—Å–ª–∏ TonPlay –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω) -->
<div class="modal" id="adModal" role="dialog" aria-modal="true">
  <div class="box">
    <h3 id="adTitle" style="margin-top:0">Sponsored Video</h3>
    <p id="adText" class="muted" style="margin:6px 0 12px">Please wait... You can skip after 5 seconds.</p>
    <div class="progress"><i id="bar"></i></div>
    <div class="row-split" style="margin-top:14px">
      <button class="btn secondary" id="skipBtn" disabled>Skip</button>
      <button class="btn" id="claimAdBtn" disabled>Close & Claim</button>
    </div>
  </div>
</div>

<script>
/* ===================== settings ===================== */
const API_BASE = "https://t21-playzone-api.t21playzone.workers.dev";
const REWARD_T21 = 100; // —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ Claim
const WITHDRAW_JETTON_WALLET = "EQBLgiPMly982IMGqauqdX0Fe_N01arD-LhlKSfxBd8rzYRG"; // —Ç–≤–æ–π jetton-–∞–¥—Ä–µ—Å

/* ===================== i18n ===================== */
const t = {
  en:{
    title:"T21 Play Zone",
    status_ok:"API connected ‚úÖ",
    status_err:(m)=>`‚ö†Ô∏è Error: ${m}`,
    balance:(v)=>`Balance: ${v} T21`,
    plays:(v)=>`Plays left: ${v}`,
    enter:"Enter your TON address",
    note:"We will save your address for payouts.",
    save:"Save Wallet",
    saved:"‚úÖ Address saved",
    claim:"üí∞ Claim Reward",
    claiming:"Processing... ‚è≥",
    claimed:"‚úÖ Reward sent! Check Tonkeeper.",
    adBtn:"üé¨ Watch Ad (+10 plays)",
    ad:"+10 plays added!",
    share:"ü§ù Share (+5 T21)",
    shareDone:"+5 T21 added for share",
    withdraw:"üí∏ Withdraw T21",
    withdrew:(n)=>`Preparing withdrawal of ${n} T21‚Ä¶`,
    needPlays:"No plays left ‚Äî watch an ad to get +10.",
    guessTitle:"üéØ Guess 1‚Äì9",
    hint:"Tap a number. Each try spends 1 play. Win small rewards randomly.",
    adTitle:"Sponsored Video",
    adText:"Please wait‚Ä¶ You can skip after 5 seconds.",
    skip:"Skip",
    claimAd:"Close & Claim",
    win:(n)=>`üéâ You won +${n} T21!`,
    lose:"Miss! Try again.",
    needAddress:"‚ö†Ô∏è Enter TON address before claiming."
  },
  ru:{
    title:"–ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ T21",
    status_ok:"API –ø–æ–¥–∫–ª—é—á–µ–Ω ‚úÖ",
    status_err:(m)=>`‚ö†Ô∏è –û—à–∏–±–∫–∞: ${m}`,
    balance:(v)=>`–ë–∞–ª–∞–Ω—Å: ${v} T21`,
    plays:(v)=>`–û—Å—Ç–∞–ª–æ—Å—å –∏–≥—Ä: ${v}`,
    enter:"–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å TON",
    note:"–°–æ—Ö—Ä–∞–Ω–∏–º –∞–¥—Ä–µ—Å –¥–ª—è –≤—ã–ø–ª–∞—Ç.",
    save:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–¥—Ä–µ—Å",
    saved:"‚úÖ –ê–¥—Ä–µ—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω",
    claim:"üî• –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É",
    claiming:"–û–±—Ä–∞–±–æ—Ç–∫–∞... ‚è≥",
    claimed:"‚úÖ –ù–∞–≥—Ä–∞–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å Tonkeeper.",
    adBtn:"üé¨ –°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É (+10 –∏–≥—Ä)",
    ad:"+10 –∏–≥—Ä –¥–æ–±–∞–≤–ª–µ–Ω–æ!",
    share:"ü§ù –ü–æ–¥–µ–ª–∏—Ç—å—Å—è (+5 T21)",
    shareDone:"+5 T21 –∑–∞ —Ä–µ–ø–æ—Å—Ç",
    withdraw:"üí∏ –í—ã–≤–µ—Å—Ç–∏ T21",
    withdrew:(n)=>`–ì–æ—Ç–æ–≤–∏–º –≤—ã–≤–æ–¥ ${n} T21‚Ä¶`,
    needPlays:"–ò–≥—Ä—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏ —Ä–µ–∫–ª–∞–º—É –∏ –ø–æ–ª—É—á–∏ +10.",
    guessTitle:"üéØ –£–≥–∞–¥–∞–π 1‚Äì9",
    hint:"–ù–∞–∂–∏–º–∞–π —á–∏—Å–ª–æ. –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Ç—Ä–∞—Ç–∏—Ç 1 –∏–≥—Ä—É. –ü—Ä–∏–∑—ã –≤—ã–¥–∞—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ.",
    adTitle:"–†–µ–∫–ª–∞–º–Ω—ã–π —Ä–æ–ª–∏–∫",
    adText:"–ü–æ–¥–æ–∂–¥–∏—Ç–µ‚Ä¶ –ü—Ä–æ–ø—É—Å–∫ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ 5 —Å–µ–∫.",
    skip:"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å",
    claimAd:"–ó–∞–∫—Ä—ã—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å",
    win:(n)=>`üéâ –ü–æ–±–µ–¥–∞! +${n} T21`,
    lose:"–ù–µ —É–≥–∞–¥–∞–ª. –ï—â—ë —Ä–∞–∑!",
    needAddress:"‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ TON-–∞–¥—Ä–µ—Å –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º."
  },
  cn:{
    title:"T21 Ê∏∏ÊàèÂå∫",
    status_ok:"API Â∑≤ËøûÊé• ‚úÖ",
    status_err:(m)=>`‚ö†Ô∏è ÈîôËØØ: ${m}`,
    balance:(v)=>`‰ΩôÈ¢ù: ${v} T21`,
    plays:(v)=>`Ââ©‰ΩôÊ¨°Êï∞: ${v}`,
    enter:"ËæìÂÖ•‰Ω†ÁöÑ TON Âú∞ÂùÄ",
    note:"Êàë‰ª¨‰ºö‰øùÂ≠òÂú∞ÂùÄÁî®‰∫éÂèëÊîæÂ•ñÂä±„ÄÇ",
    save:"‰øùÂ≠òÂú∞ÂùÄ",
    saved:"‚úÖ Â∑≤‰øùÂ≠òÂú∞ÂùÄ",
    claim:"üí∞ È¢ÜÂèñÂ•ñÂä±",
    claiming:"Â§ÑÁêÜ‰∏≠... ‚è≥",
    claimed:"‚úÖ Â•ñÂä±Â∑≤ÂèëÈÄÅÔºÅËØ∑Êü• Tonkeeper„ÄÇ",
    adBtn:"üé¨ ÁúãÂπøÂëäÔºà+10 Ê¨°Ôºâ",
    ad:"+10 Ê¨°Êï∞Â∑≤Ê∑ªÂä†ÔºÅ",
    share:"ü§ù ÂàÜ‰∫´Ôºà+5 T21Ôºâ",
    shareDone:"ÂàÜ‰∫´Â•ñÂä± +5 T21",
    withdraw:"üí∏ ÊèêÁé∞ T21",
    withdrew:(n)=>`ÂáÜÂ§áÊèêÁé∞ ${n} T21‚Ä¶`,
    needPlays:"Ê¨°Êï∞Áî®ÂÆå‚ÄîÁúãÂπøÂëäËé∑Âæó +10„ÄÇ",
    guessTitle:"üéØ ÁåúÊï∞Â≠ó 1‚Äì9",
    hint:"ÁÇπÊï∞Â≠óÔºåÊØèÊ¨°Ê∂àËÄó 1 Ê¨°ÔºåÂ•ñÂä±ÈöèÊú∫ÂèëÊîæ„ÄÇ",
    adTitle:"ËµûÂä©ËßÜÈ¢ë",
    adText:"ËØ∑Á®çÁ≠â‚Ä¶ 5 ÁßíÂêéÂèØË∑≥Ëøá„ÄÇ",
    skip:"Ë∑≥Ëøá",
    claimAd:"ÂÖ≥Èó≠Âπ∂È¢ÜÂèñ",
    win:(n)=>`üéâ Ëé∑Âæó +${n} T21`,
    lose:"Ê≤°‰∏≠ÔºåÂÜçËØïÔºÅ",
    needAddress:"‚ö†Ô∏è È¢ÜÂèñÂâçËØ∑ÂÖàÂ°´ÂÜô TON Âú∞ÂùÄ„ÄÇ"
  },
  in:{
    title:"T21 ‡§™‡•ç‡§≤‡•á ‡§ú‡§º‡•ã‡§®",
    status_ok:"API ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡•á‡§° ‚úÖ",
    status_err:(m)=>`‚ö†Ô∏è ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ${m}`,
    balance:(v)=>`‡§¨‡•à‡§≤‡•á‡§Ç‡§∏: ${v} T21`,
    plays:(v)=>`‡§¨‡§æ‡§ï‡•Ä ‡§ö‡§æ‡§≤‡•á‡§Ç: ${v}`,
    enter:"‡§Ö‡§™‡§®‡§æ TON ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
    note:"‡§á‡§®‡§æ‡§Æ ‡§≠‡•á‡§ú‡§®‡•á ‡§π‡•á‡§§‡•Å ‡§™‡§§‡§æ ‡§∏‡•á‡§µ ‡§π‡•ã‡§ó‡§æ‡•§",
    save:"‡§∏‡•á‡§µ ‡§µ‡•â‡§≤‡•á‡§ü",
    saved:"‚úÖ ‡§™‡§§‡§æ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ",
    claim:"üí∞ ‡§∞‡§ø‡§µ‡•â‡§∞‡•ç‡§° ‡§≤‡•á‡§Ç",
    claiming:"‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó... ‚è≥",
    claimed:"‚úÖ ‡§∞‡§ø‡§µ‡•â‡§∞‡•ç‡§° ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ! Tonkeeper ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§",
    adBtn:"üé¨ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç (+10)",
    ad:"+10 ‡§ö‡§æ‡§≤‡•á‡§Ç ‡§Æ‡§ø‡§≤ ‡§ó‡§à‡§Ç!",
    share:"ü§ù ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç (+5 T21)",
    shareDone:"‡§∂‡•á‡§Ø‡§∞ ‡§¨‡•ã‡§®‡§∏ +5 T21",
    withdraw:"üí∏ T21 ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç",
    withdrew:(n)=>`${n} T21 ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‚Ä¶`,
    needPlays:"‡§ö‡§æ‡§≤‡•á‡§Ç ‡§ñ‡§§‡•ç‡§Æ‚Äî+10 ‡§™‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç„ÄÇ",
    guessTitle:"üéØ 1‚Äì9 ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç",
    hint:"‡§π‡§∞ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ 1 ‡§ö‡§æ‡§≤ ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§®‡§æ‡§Æ ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§π‡•à‡•§",
    adTitle:"‡§™‡•ç‡§∞‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã",
    adText:"5 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§¨‡§æ‡§¶ Skip ‡§π‡•ã‡§ó‡§æ„ÄÇ",
    skip:"Skip",
    claimAd:"Close & Claim",
    win:(n)=>`üéâ ‡§ú‡•Ä‡§§‡•á +${n} T21`,
    lose:"‡§ö‡•Ç‡§ï ‡§ó‡§è, ‡§´‡§ø‡§∞ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç!",
    needAddress:"‚ö†Ô∏è ‡§™‡§π‡§≤‡•á TON ‡§™‡§§‡§æ ‡§≠‡§∞‡•á‡§Ç‡•§"
  },
  am:{
    title:"T21 ‘Ω’°’≤’°’µ’´’∂ ’£’∏’ø’´",
    status_ok:"API ’¥’´’°÷Å’æ’°’Æ ’ß ‚úÖ",
    status_err:(m)=>`‚ö†Ô∏è ’ç’≠’°’¨: ${m}`,
    balance:(v)=>`’Ñ’∂’°÷Å’∏÷Ä’§’ù ${v} T21`,
    plays:(v)=>`’Ñ’∂’°÷Å’°’Æ ’≠’°’≤’•÷Ä’ù ${v}`,
    enter:"’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’•÷Ñ ’±’•÷Ä TON ’∞’°’Ω÷Å’•’∂",
    note:"’Ä’°’Ω÷Å’•’∂ ’Ø’∫’°’∞’∫’°’∂’•’∂÷Ñ ’æ’≥’°÷Ä’∏÷Ç’¥’∂’•÷Ä’´ ’∞’°’¥’°÷Ä÷â",
    save:"’ä’°’∞’∫’°’∂’•’¨ ’∞’°’Ω÷Å’•’∂",
    saved:"‚úÖ ’Ä’°’Ω÷Å’•’∂ ’∫’°’∞’∫’°’∂’æ’•÷Å",
    claim:"üí∞ ’ç’ø’°’∂’°’¨ ’∫’°÷Ä’£÷á’®",
    claiming:"’Ñ’∑’°’Ø’æ’∏÷Ç’¥ ’ß... ‚è≥",
    claimed:"‚úÖ ’ä’°÷Ä’£÷á’® ’∏÷Ç’≤’°÷Ä’Ø’æ’°’Æ ’ß! ’ç’ø’∏÷Ç’£’•÷Ñ Tonkeeper-’®÷â",
    adBtn:"üé¨ ‘¥’´’ø’•’¨ ’£’∏’æ’°’¶’§’® (+10 ’≠’°’≤)",
    ad:"+10 ’≠’°’≤ ’°’æ’•’¨’°÷Å’æ’•÷Å!",
    share:"ü§ù ‘ø’´’Ω’æ’•’¨ (+5 T21)",
    shareDone:"+5 T21 ’Ø’´’Ω’æ’•’¨’∏÷Ç ’∞’°’¥’°÷Ä",
    withdraw:"üí∏ ‘¥’∏÷Ç÷Ä’Ω ’¢’•÷Ä’•’¨ T21",
    withdrew:(n)=>`’ä’°’ø÷Ä’°’Ω’ø’∏÷Ç’¥ ’•’∂÷Ñ ${n} T21 ’§’∏÷Ç÷Ä’Ω’¢’•÷Ä’∏÷Ç’¥‚Ä¶`,
    needPlays:"‘Ω’°’≤’•÷Ä’® ’æ’•÷Ä’ª’°÷Å’°’∂ ‚Äî ’§’´’ø’´÷Ä ’£’∏’æ’°’¶’§ ÷á ’Ω’ø’°÷Å’´÷Ä +10÷â",
    guessTitle:"üéØ ‘ø’º’°’∞’´÷Ä 1‚Äì9",
    hint:"’Ö’∏÷Ç÷Ä’°÷Ñ’°’∂’π’µ’∏÷Ç÷Ä ÷É’∏÷Ä’±’® ’Æ’°’≠’Ω’∏÷Ç’¥ ’ß 1 ’≠’°’≤÷â ’Ñ÷Ä÷Å’°’∂’°’Ø’∂’•÷Ä’® ’∫’°’ø’°’∞’°’Ø’°’∂ ’•’∂÷â",
    adTitle:"’Ä’∏’æ’°’∂’°’æ’∏÷Ä’´ ’ø’•’Ω’°’∞’∏’¨’∏’æ’°’Ø",
    adText:"5 ’æ÷Ä’Ø ’∞’•’ø’∏ ’Ø’°÷Ä’∏’≤ ’•÷Ñ Skip ’°’∂’•’¨÷â",
    skip:"Skip",
    claimAd:"’ì’°’Ø’•’¨ ÷á ’Ω’ø’°’∂’°’¨",
    win:(n)=>`üéâ ’Ä’°’≤’©’°’∂’°’Ø +${n} T21`,
    lose:"’â’Ω’ø’°÷Å’æ’•÷Å, ’∂’∏÷Ä’´÷Å ÷É’∏÷Ä’±’´÷Ä!",
    needAddress:"‚ö†Ô∏è ’Ü’°’≠ ’¥’∏÷Ç’ø÷Ñ’°’£÷Ä’´÷Ä TON ’∞’°’Ω÷Å’•’∂÷â"
  }
};

/* ============== state & helpers ============== */
let lang = localStorage.getItem('t21_lang') || 'ru';
let balance = Number(localStorage.getItem('t21_balance')||0);
let plays   = Number(localStorage.getItem('t21_plays')||100);
let wallet  = localStorage.getItem('t21_wallet') || '';
let shared  = localStorage.getItem('t21_shared') === '1';
let target  = (Math.random()*9|0)+1;

const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);

const el = {
  langSel: $('#langSel'),
  status: $('#status'),
  balanceBox: $('#balanceBox'),
  playsBox: $('#playsBox'),
  wallet: $('#wallet'),
  saveBtn: $('#saveBtn'),
  saveNote: $('#saveNote'),
  claimBtn: $('#claimBtn'),
  adBtn: $('#adBtn'),
  shareBtn: $('#shareBtn'),
  withdrawBtn: $('#withdrawBtn'),
  guessTitle: $('#guessTitle'),
  hintNote: $('#hintNote'),
  keys: $('#keys'),
  flash: $('#flash'),
  adModal: $('#adModal'), bar: $('#bar'),
  adTitle: $('#adTitle'), adText: $('#adText'),
  skipBtn: $('#skipBtn'), claimAdBtn: $('#claimAdBtn'),
};

function flash(msg, ms=1600){
  el.flash.textContent = msg;
  el.flash.style.display='block';
  setTimeout(()=>el.flash.style.display='none', ms);
}
function saveState(){
  localStorage.setItem('t21_balance', balance);
  localStorage.setItem('t21_plays', plays);
  localStorage.setItem('t21_wallet', wallet);
  localStorage.setItem('t21_lang', lang);
  localStorage.setItem('t21_shared', shared?'1':'0');
}
function fmt(n){ return (Math.round(n*100)/100).toString(); }
function isTonAddr(s){ return /^E[QQ]|^UQ/.test(s) || /^EQ|^UQ/.test(s); }

function updateUI(){
  const tr=t[lang];
  document.title = tr.title;
  $('.brand h1').textContent = tr.title;
  el.balanceBox.textContent = tr.balance(fmt(balance));
  el.playsBox.textContent   = tr.plays(plays);
  $('#enterLbl').textContent = tr.enter;
  el.saveBtn.textContent = tr.save;
  el.saveNote.textContent = tr.note;
  el.claimBtn.textContent = tr.claim;
  el.adBtn.textContent = tr.adBtn;
  el.shareBtn.textContent = tr.share + (shared?' ‚úÖ':'');
  el.withdrawBtn.textContent = tr.withdraw;
  el.guessTitle.textContent = tr.guessTitle;
  el.hintNote.textContent = tr.hint;
  el.wallet.value = wallet;

  el.adTitle.textContent = tr.adTitle;
  el.adText.textContent = tr.adText;
  el.skipBtn.textContent = tr.skip;
  el.claimAdBtn.textContent = tr.claimAd;

  el.keys.classList.toggle('disabled', plays<=0);
  $$('.key').forEach(k=>{
    if(plays<=0){ k.classList.add('disabled'); k.style.pointerEvents='none'; k.style.opacity=.45; }
    else{ k.classList.remove('disabled'); k.style.pointerEvents='auto'; k.style.opacity=1; }
  });
}

/* ============== build keypad ============== */
for(let i=1;i<=9;i++){
  const b=document.createElement('button');
  b.className='key';
  b.textContent=i;
  b.onclick=()=>onGuess(i);
  el.keys.appendChild(b);
}

/* ============== game logic ============== */
function onGuess(n){
  if(plays<=0){ flash(t[lang].needPlays); return; }
  plays--;
  let prize = 0;
  const r = Math.random();
  if(n===target){
    if(r<0.70) prize=1;
    else if(r<0.92) prize=3;
    else if(r<0.985) prize=5;
    else if(r<0.997) prize=7;
    else prize=10;
    balance+=prize;
    flash(t[lang].win(prize));
  }else{
    flash(t[lang].lose, 900);
  }
  if(plays===0) flash(t[lang].needPlays, 2200);
  target=(Math.random()*9|0)+1;
  saveState(); updateUI();
}

/* ============== language ============== */
el.langSel.value = lang;
el.langSel.onchange = ()=>{ lang=el.langSel.value; saveState(); updateUI(); };

/* ============== wallet save ============== */
$('#saveBtn').onclick=()=>{
  wallet = el.wallet.value.trim();
  if(!isTonAddr(wallet)){ flash('‚ùó'); return; }
  saveState(); updateUI(); flash(t[lang].saved);
};

/* ============== Share bonus ============== */
el.shareBtn.onclick=()=>{
  if(shared){ flash('‚úÖ'); return; }
  const text = "Play & earn T21 in T21 Play Zone!";
  const url  = location.href;
  if(navigator.share){ navigator.share({title:"T21 Play Zone",text, url}).catch(()=>{}); }
  else{ navigator.clipboard.writeText(`${text} ${url}`).catch(()=>{}); }
  shared = true; balance += 5; saveState(); updateUI(); flash(t[lang].shareDone);
};

/* ============== Withdraw (demo link to jetton wallet) ============== */
el.withdrawBtn.onclick=()=>{
  if(balance<=0){ flash('‚ùó'); return; }
  const amount = balance; balance = 0; saveState(); updateUI();
  flash(t[lang].withdrew(amount));
  const nano = Math.round(amount * 1_000_000);
  const url = `ton://transfer/${WITHDRAW_JETTON_WALLET}?amount=${nano}&text=T21%20reward`;
  setTimeout(()=>window.open(url,'_blank'), 800);
};

/* ============== Claim via REAL API ============== */
async function claimReward(){
  const btn = el.claimBtn;
  if(!isTonAddr(wallet)){ flash(t[lang].needAddress, 1800); return; }
  try{
    btn.disabled=true; btn.textContent=t[lang].claiming;
    const res = await fetch(`${API_BASE}/api/claim`,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ address: wallet, reward: REWARD_T21 })
    });
    const data = await res.json().catch(()=>({ok:false,error:"Invalid JSON"}));
    if(data.ok){
      flash(t[lang].claimed, 1800);
      // –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∫–∞–∫ ‚Äú–≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ‚Äù
      balance += REWARD_T21; saveState(); updateUI();
    }else{
      flash(t[lang].status_err(data.error||res.status), 2200);
    }
  }catch(e){
    console.error(e);
    flash(t[lang].status_err(e.message||"Network"), 2200);
  }finally{
    btn.disabled=false; btn.textContent=t[lang].claim;
  }
}
el.claimBtn.onclick = claimReward;

/* ============== Ads: TonPlay if available, else fallback modal ============== */
el.adBtn.onclick = async ()=>{
  // –ï—Å–ª–∏ TonPlay SDK –µ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ä–µ–∫–ª–∞–º–∞
  if(window.TonPlay && TonPlay.ads && TonPlay.ads.rewarded){
    try{
      await TonPlay.ads.rewarded.show();
      plays+=10; saveState(); updateUI(); flash(t[lang].ad);
      return;
    }catch(e){
      console.warn("TonPlay rewarded failed, fallback", e);
    }
  }
  // –§–æ–ª–±–µ–∫-—Å–∏–º—É–ª—è—Ü–∏—è —Ä–µ–∫–ª–∞–º—ã
  el.adModal.style.display='flex';
  let tsec=0, total=30; el.bar.style.width='0%';
  el.claimAdBtn.disabled=true; el.skipBtn.disabled=true;
  const timer=setInterval(()=>{
    tsec++; el.bar.style.width = (tsec/total*100)+'%';
    if(tsec>=5) el.skipBtn.disabled=false;
    if(tsec>=30){ clearInterval(timer); el.claimAdBtn.disabled=false; }
  },1000);

  function closeClaim(add){
    el.adModal.style.display='none';
    el.skipBtn.onclick=null; el.claimAdBtn.onclick=null;
    if(add){ plays+=10; saveState(); updateUI(); flash(t[lang].ad); }
  }
  el.skipBtn.onclick = ()=>closeClaim(false);
  el.claimAdBtn.onclick = ()=>closeClaim(true);
};

/* ============== Ping API on load (to show status) ============== */
(async ()=>{
  try{
    const r = await fetch(`${API_BASE}/api/ping`, {cache:"no-store"});
    if(r.ok){ el.status.textContent = t[lang].status_ok; }
    else { el.status.textContent = t[lang].status_err(r.status); }
  }catch(e){ el.status.textContent = t[lang].status_err("offline"); }
})();

/* init */
updateUI();
</script>
</body>
</html>
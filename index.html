<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>T21 Play Zone</title>
  <meta name="color-scheme" content="dark light"/>
  <style>
    :root{--bg:#0b0f16;--panel:#111724;--gold1:#ffdf88;--gold2:#f0cf6d;--txt:#e8ecf7;--muted:#9fb0c3}
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:#0b0f16;color:var(--txt);font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:680px;margin:0 auto;padding:28px}
    .row{margin:14px 0}
    .card{background:var(--panel);border-radius:16px;padding:18px}
    h1{margin:0 0 8px;font-size:28px}
    h3{margin:22px 0 12px;font-size:20px}
    .muted{color:var(--muted);font-size:14px}
    select, input, button{width:100%;padding:14px 16px;border-radius:12px;border:0;font-size:16px}
    select, input{background:#0f1524;color:var(--txt)}
    button{background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#1b2232;font-weight:700;cursor:pointer}
    button[disabled]{opacity:.5;cursor:not-allowed}
    .btn-outline{background:transparent;border:2px solid var(--gold2);color:var(--txt)}
    .grid9{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .grid9 button{background:#0f1524;color:var(--txt);border:1px solid #243045;font-size:20px}
    .bar{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .pill{display:inline-block;background:#0f1524;border:1px solid #243045;padding:8px 12px;border-radius:999px;color:var(--muted);font-size:14px}
    .center{text-align:center}
    /* modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:18px;z-index:50}
    .modal .box{background:#0f1524;border:1px solid #243045;border-radius:14px;max-width:440px;width:100%;padding:18px}
    .progress{height:8px;border-radius:8px;background:#243045;overflow:hidden}
    .progress-fill{height:100%;width:0;background:linear-gradient(90deg,var(--gold1),var(--gold2))}
    .flash{position:fixed;inset:auto auto 60px 50%;transform:translateX(-50%);background:#112b18;border:1px solid #245b2e;padding:10px 14px;border-radius:10px;color:#c9ffd1;font-weight:700;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row bar">
      <h1 id="title">üíé T21 Play Zone</h1>
      <select id="lang"></select>
    </div>

    <div class="row card">
      <div class="bar">
        <div class="pill" id="balance">Balance: 0 T21</div>
        <div class="pill" id="plays">Plays left: 100</div>
      </div>
      <div class="muted" id="limitLine" style="margin-top:8px"></div>
      <div class="row"><input id="wallet" placeholder="Enter your TON address"/></div>
      <div class="row"><button id="saveBtn">Save Wallet</button></div>
      <div class="row"><button id="adBtn">üé¨ Watch Ad (+10 plays)</button></div>
      <div class="row"><button class="btn-outline" id="shareBtn">ü§ù Share (+5 T21)</button></div>
    </div>

    <h3 id="guessTitle">üéØ Guess 1‚Äì9</h3>
    <div class="card">
      <div id="numbers" class="grid9"></div>
      <div class="center muted" id="hint" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- Ad modal -->
  <div class="modal" id="adModal">
    <div class="box">
      <h3 id="adTitle">Sponsored Video</h3>
      <div class="muted" id="adSub">Please wait... You can skip after 5 seconds.</div>
      <div class="row progress"><div class="progress-fill" id="adFill"></div></div>
      <div class="bar">
        <button class="btn-outline" id="skipBtn" disabled>Skip</button>
        <button id="claimBtn" disabled>Close & Claim</button>
      </div>
    </div>
  </div>

  <!-- End-of-plays modal -->
  <div class="modal" id="endModal">
    <div class="box">
      <h3 id="endTitle">Games finished!</h3>
      <div class="muted" id="endText">Watch an ad to get +10 plays or withdraw your rewards.</div>
      <div class="row"><button id="endAdBtn">üé¨ Watch Ad (+10 plays)</button></div>
      <div class="row"><button class="btn-outline" id="withdrawBtn">üí∏ Withdraw (coming soon)</button></div>
    </div>
  </div>

  <div id="flash" class="flash"></div>

<script>
/* ====== CONFIG ====== */
const API = ""; // ‚Üê –µ—Å–ª–∏ –µ—Å—Ç—å backend (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://t21-playzone-api.t21playzone.workers.dev), —É–∫–∞–∂–∏ —Å—é–¥–∞. –ü—É—Å—Ç–æ = –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º.
const START_PLAYS = 100;
const AD_GAIN_PLAYS = 10;
const SHARE_GAIN_T21 = 5;

/* ====== STATE ====== */
let lang = localStorage.getItem("t21_lang") || "EN";
let wallet = localStorage.getItem("t21_wallet") || "";
let balance = 0;
let plays = START_PLAYS;
let limit = START_PLAYS; // –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ¬´–ª–∏–º–∏—Ç/–¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç¬ª (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)

/* ====== I18N ====== */
const I18N = {
  EN:{title:"üíé T21 Play Zone", bal:"Balance", plays:"Plays left", limit:(n)=>`Daily limit: ${n}`,
      save:"Save Wallet", watchAd:"Watch Ad (+10 plays)", share:"Share (+5 T21)", guess:"üéØ Guess 1‚Äì9",
      sponsored:"Sponsored Video", adSub:"Please wait... You can skip after 5 seconds.",
      closeClaim:"Close & Claim", gamesEndTitle:"No games left!", gamesEndText:"Watch an ad to get +10 plays or withdraw your rewards.",
      withdraw:"üí∏ Withdraw (coming soon)", hint:"Pick a number 1‚Äì9", saved:"Wallet saved", win:(r)=>`üéØ You won +${r} T21`, lose:(x)=>`‚ùå Wrong! It was ${x}`,
      adBlocked:"You still have plays. Spend them first to unlock ads.", shareOnce:"You‚Äôve already claimed Share reward today."},
  RU:{title:"üíé T21 –ò–≥—Ä–æ–≤–∞—è –ó–æ–Ω–∞", bal:"–ë–∞–ª–∞–Ω—Å", plays:"–û—Å—Ç–∞–ª–æ—Å—å –∏–≥—Ä", limit:(n)=>`–õ–∏–º–∏—Ç: ${n}`,
      save:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–¥—Ä–µ—Å", watchAd:"–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É (+10 –∏–≥—Ä)", share:"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è (+5 T21)", guess:"üéØ Guess 1‚Äì9",
      sponsored:"–†–µ–∫–ª–∞–º–Ω—ã–π —Ä–æ–ª–∏–∫", adSub:"–ü–æ–¥–æ–∂–¥–∏—Ç–µ... –ü—Ä–æ–ø—É—Å–∫ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥.",
      closeClaim:"–ó–∞–∫—Ä—ã—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å", gamesEndTitle:"–ò–≥—Ä—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!", gamesEndText:"–°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∫–ª–∞–º—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å +10 –∏–≥—Ä, –∏–ª–∏ –≤—ã–≤–µ–¥–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É.",
      withdraw:"üí∏ –í—ã–≤–µ—Å—Ç–∏ (—Å–∫–æ—Ä–æ)", hint:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9", saved:"–ê–¥—Ä–µ—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω", win:(r)=>`üéØ –£–≥–∞–¥–∞–ª! +${r} T21`, lose:(x)=>`‚ùå –ú–∏–º–æ! –ë—ã–ª–æ ${x}`,
      adBlocked:"–£ —Ç–µ–±—è –µ—â—ë –µ—Å—Ç—å –∏–≥—Ä—ã. –°–Ω–∞—á–∞–ª–∞ –∏–∑—Ä–∞—Å—Ö–æ–¥—É–π –∏—Ö, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ä–µ–∫–ª–∞–º—É.", shareOnce:"–ë–æ–Ω—É—Å –∑–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è."},
  CN:{title:"üíé T21 Ê∏∏ÊàèÂå∫", bal:"‰ΩôÈ¢ù", plays:"Ââ©‰ΩôÊ¨°Êï∞", limit:(n)=>`Ê¨°Êï∞‰∏äÈôê: ${n}`,
      save:"‰øùÂ≠òÂú∞ÂùÄ", watchAd:"ÁúãÂπøÂëäÔºà+10 Ê¨°Ôºâ", share:"ÂàÜ‰∫´Ôºà+5 T21Ôºâ", guess:"üéØ ÁåúÊï∞Â≠ó 1‚Äì9",
      sponsored:"ËµûÂä©ËßÜÈ¢ë", adSub:"ËØ∑Á®çÂÄô‚Ä¶ 5ÁßíÂêéÂèØË∑≥Ëøá„ÄÇ",
      closeClaim:"ÂÖ≥Èó≠Âπ∂È¢ÜÂèñ", gamesEndTitle:"Ê≤°ÊúâÊ¨°Êï∞‰∫ÜÔºÅ", gamesEndText:"ËßÇÁúãÂπøÂëäËé∑Âæó +10 Ê¨°ÔºåÊàñÊèêÁé∞Â•ñÂä±„ÄÇ",
      withdraw:"üí∏ ÊèêÁé∞ÔºàÂç≥Â∞ÜÂºÄÊîæÔºâ", hint:"ÈÄâÊã© 1~9 ÁöÑÊï∞Â≠ó", saved:"Âú∞ÂùÄÂ∑≤‰øùÂ≠ò", win:(r)=>`üéØ ‰Ω†Ëµ¢Âæó +${r} T21`, lose:(x)=>`‚ùå Ê≤°Áåú‰∏≠ÔºÅÁ≠îÊ°àÊòØ ${x}`,
      adBlocked:"‰Ω†ËøòÊúâÊ¨°Êï∞„ÄÇÁî®ÂÆåÂêéÊâçËÉΩÁúãÂπøÂëä„ÄÇ", shareOnce:"‰ªäÂ§©Â∑≤È¢ÜÂèñÂàÜ‰∫´Â•ñÂä±„ÄÇ"},
  IN:{title:"üíé T21 ‡§ñ‡•á‡§≤ ‡§ú‡§º‡•ã‡§®", bal:"‡§¨‡•à‡§≤‡•á‡§Ç‡§∏", plays:"‡§¨‡§æ‡§ï‡•Ä ‡§ö‡§æ‡§≤‡•á‡§Ç", limit:(n)=>`‡§∏‡•Ä‡§Æ‡§æ: ${n}`,
      save:"‡§™‡§§‡§æ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç", watchAd:"‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç (+10 ‡§ö‡§æ‡§≤‡•á‡§Ç)", share:"‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç (+5 T21)", guess:"üéØ 1‚Äì9 ‡§ö‡•Å‡§®‡•á‡§Ç",
      sponsored:"‡§™‡•ç‡§∞‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã", adSub:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç‚Ä¶ 5 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§¨‡§æ‡§¶ Skip ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§",
      closeClaim:"Close & Claim", gamesEndTitle:"‡§ö‡§æ‡§≤‡•á‡§Ç ‡§ñ‡§§‡•ç‡§Æ!", gamesEndText:"+10 ‡§ö‡§æ‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§Ø‡§æ ‡§∞‡§ø‡§µ‡•â‡§∞‡•ç‡§° ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç‡•§",
      withdraw:"üí∏ Withdraw (‡§ú‡§≤‡•ç‡§¶)", hint:"1‚Äì9 ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç", saved:"‡§™‡§§‡§æ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ", win:(r)=>`üéØ ‡§ú‡•Ä‡§§‡•á +${r} T21`, lose:(x)=>`‚ùå ‡§ó‡§≤‡§§! ${x} ‡§•‡§æ`,
      adBlocked:"‡§Ö‡§≠‡•Ä ‡§≠‡•Ä ‡§ö‡§æ‡§≤‡•á‡§Ç ‡§¨‡§ö‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§ ‡§™‡§π‡§≤‡•á ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§ñ‡§º‡§§‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§", shareOnce:"‡§Ü‡§ú ‡§ï‡§æ Share ‡§∞‡§ø‡§µ‡•â‡§∞‡•ç‡§° ‡§Æ‡§ø‡§≤ ‡§ö‡•Å‡§ï‡§æ ‡§π‡•à‡•§"},
  AM:{title:"üíé T21 ‘Ω’°’≤’°’µ’´’∂ ‘≥’∏’ø’´", bal:"’Ñ’∂’°÷Å’∏÷Ä’§", plays:"’Ñ’∂’°÷Å’°’Æ ’≠’°’≤’•÷Ä", limit:(n)=>`’ç’°’∞’¥’°’∂’°÷É’°’Ø’∏÷Ç’¥’ù ${n}`,
      save:"’ä’°’∞’∫’°’∂’•’¨ ’∞’°’Ω÷Å’•’∂", watchAd:"‘¥’´’ø’•’¨ ’£’∏’æ’°’¶’§ (+10 ’≠’°’≤)", share:"‘ø’´’Ω’æ’•’¨ (+5 T21)", guess:"üéØ ‘ø’º’°’∞’´÷Ä 1‚Äì9",
      sponsored:"’Ä’∏’æ’°’∂’°’æ’∏÷Ä’°’Æ ’ø’•’Ω’°’∂’µ’∏÷Ç’©", adSub:"’ç’∫’°’Ω’•÷Ñ‚Ä¶ Skip ’Ø’∏’≥’°’Ø’® 5 ’æ÷Ä’Ø ’∞’•’ø’∏÷â",
      closeClaim:"’ì’°’Ø’•’¨ ÷á ’Ω’ø’°’∂’°’¨", gamesEndTitle:"‘Ω’°’≤’•÷Ä’® ’æ’•÷Ä’ª’°÷Å’°’∂!", gamesEndText:"+10 ’≠’°’≤ ’Ω’ø’°’∂’°’¨’∏÷Ç ’∞’°’¥’°÷Ä ’§’´’ø’•÷Ñ ’£’∏’æ’°’¶’§ ’Ø’°’¥ ’§’∏÷Ç÷Ä’Ω ’¢’•÷Ä’•÷Ñ ’∞’°’≤’©’°’∂’°’Ø’®÷â",
      withdraw:"üí∏ ‘¥’∏÷Ç÷Ä’Ω ’¢’•÷Ä’•’¨ (’∑’∏÷Ç’ø’∏’æ)", hint:"‘∏’∂’ø÷Ä’•÷Ñ 1‚Äì9 ’©’´’æ", saved:"’Ä’°’Ω÷Å’•’∂ ’∫’°’∞’∫’°’∂’æ’•÷Å", win:(r)=>`üéØ ’Ä’°’≤’©’•÷Å’´÷Ä +${r} T21`, lose:(x)=>`‚ùå ’ç’≠’°’¨! ${x} ’ß÷Ä`,
      adBlocked:"‘¥’•’º ’∏÷Ç’∂’•’Ω ’≠’°’≤’•÷Ä‚Ä§ ’∂’°’≠ ’°’æ’°÷Ä’ø’´÷Ä ’§÷Ä’°’∂÷Ñ÷â", shareOnce:"‘±’µ’Ω÷Ö÷Ä ’°÷Ä’§’•’∂ ’Ω’ø’°÷Å’•’¨ ’•’Ω ¬´‘ø’´’Ω’æ’•’¨¬ª-’´ ’∫’°÷Ä’£÷á’®÷â"}
};

const LANGS = [["EN","üá∫üá∏ EN"],["RU","üá∑üá∫ RU"],["CN","üá®üá≥ CN"],["IN","üáÆüá≥ IN"],["AM","üá¶üá≤ AM"]];

/* ====== UI HOOKS ====== */
const $ = (id)=>document.getElementById(id);
const el = {
  title: $("title"), balanceEl:$("balance"), playsEl:$("plays"), limitLine:$("limitLine"),
  wallet: $("wallet"), saveBtn:$("saveBtn"), adBtn:$("adBtn"), shareBtn:$("shareBtn"),
  guessTitle:$("guessTitle"), numbers:$("numbers"), hint:$("hint"), lang:$("lang"),
  adModal:$("adModal"), endModal:$("endModal"), adFill:$("adFill"), adTitle:$("adTitle"),
  adSub:$("adSub"), skipBtn:$("skipBtn"), claimBtn:$("claimBtn"), endAdBtn:$("endAdBtn"),
  withdrawBtn:$("withdrawBtn"), endTitle:$("endTitle"), endText:$("endText"), flash:$("flash")
};

/* ====== HELPERS ====== */
function t(key, ...args){
  const pack = I18N[lang];
  const v = pack[key];
  return typeof v === "function" ? v(...args) : v;
}
function flash(msg){
  el.flash.textContent = msg;
  el.flash.style.display = "block";
  setTimeout(()=>{ el.flash.style.display="none"; }, 1500);
}
function saveLocal(){
  localStorage.setItem("t21_lang", lang);
  localStorage.setItem("t21_wallet", wallet);
  localStorage.setItem("t21_balance", balance);
  localStorage.setItem("t21_plays", plays);
  localStorage.setItem("t21_limit", limit);
}
function loadLocal(){
  if(localStorage.getItem("t21_balance")) balance = +localStorage.getItem("t21_balance");
  if(localStorage.getItem("t21_plays")) plays = +localStorage.getItem("t21_plays");
  if(localStorage.getItem("t21_limit")) limit = +localStorage.getItem("t21_limit");
}

/* ====== BACKEND ====== */
async function apiState(){
  if(!API || !wallet) return;
  try{
    const r = await fetch(`${API}/state?wallet=${encodeURIComponent(wallet)}`);
    if(r.ok){
      const js = await r.json();
      if(typeof js.balance==="number") balance = js.balance;
      if(typeof js.plays==="number") plays = js.plays;
      if(typeof js.limit==="number") limit = js.limit;
      saveLocal(); updateUI();
    }
  }catch(_){}
}
// (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–µ—Ä–≥–∞—Ç—å –±—ç–∫–µ–Ω–¥ –Ω–∞ –∏–≥—Ä—É:
async function apiPlay(number){
  if(!API || !wallet) return null;
  try{
    const r = await fetch(`${API}/play/number=${number}?wallet=${encodeURIComponent(wallet)}`);
    if(r.ok) return await r.json();
  }catch(_){}
  return null;
}
// (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–µ—Ä–≥–∞—Ç—å –±—ç–∫–µ–Ω–¥ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–≥—Ä –ø–æ—Å–ª–µ —Ä–µ–∫–ª–∞–º—ã
async function apiAdGain(){
  if(!API || !wallet) return;
  try{
    // –¥–æ–≥–æ–≤–æ—Ä–∏–º—Å—è: amount=10 –æ–∑–Ω–∞—á–∞–µ—Ç +10 –ò–ì–† (–≤ —Ç–≤–æ—ë–º –≤–æ—Ä–∫–µ—Ä–µ –æ–±—Ä–∞–±–æ—Ç–∞–π —ç—Ç–æ)
    await fetch(`${API}/ad/amount=10?wallet=${encodeURIComponent(wallet)}`);
  }catch(_){}
}

/* ====== UI RENDER ====== */
function applyLang(){
  // fill selector
  el.lang.innerHTML = LANGS.map(([v,label])=>`<option value="${v}">${label}</option>`).join("");
  el.lang.value = lang;
  // text
  document.title = t("title");
  el.title.textContent = t("title");
  el.balanceEl.textContent = `${t("bal")}: ${balance} T21`;
  el.playsEl.textContent = `${t("plays")}: ${plays}`;
  el.limitLine.textContent = t("limit")(limit);
  el.wallet.placeholder = "Enter your TON address";
  el.saveBtn.textContent = t("save");
  el.adBtn.textContent = t("watchAd");
  el.shareBtn.textContent = t("share");
  el.guessTitle.textContent = t("guess");
  el.hint.textContent = t("hint");
  $("adTitle").textContent = t("sponsored");
  $("adSub").textContent = t("adSub");
  $("claimBtn").textContent = t("closeClaim");
  $("endTitle").textContent = t("gamesEndTitle");
  $("endText").textContent = t("gamesEndText");
  $("endAdBtn").textContent = t("watchAd");
  $("withdrawBtn").textContent = t("withdraw");
}
function updateUI(){
  el.balanceEl.textContent = `${t("bal")}: ${balance} T21`;
  el.playsEl.textContent = `${t("plays")}: ${plays}`;

  // —Ä–µ–∫–ª–∞–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ plays == 0
  el.adBtn.disabled = plays > 0;
}

/* ====== GAME ====== */
function makeButtons(){
  el.numbers.innerHTML = "";
  for(let i=1;i<=9;i++){
    const b = document.createElement("button");
    b.textContent = i;
    b.onclick = ()=>onGuess(i);
    el.numbers.appendChild(b);
  }
}
async function onGuess(n){
  if(plays<=0){
    el.endModal.style.display="flex";
    return;
  }
  plays--; // —Ç—Ä–∞—Ç–∏–º –ø–æ–ø—ã—Ç–∫—É —Å—Ä–∞–∑—É
  let result = null;
  if(API && wallet) result = await apiPlay(n);

  // –µ—Å–ª–∏ –µ—Å—Ç—å –±—ç–∫–µ–Ω–¥-–æ—Ç–≤–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ. –ò–Ω–∞—á–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å–∏–º—É–ª—è—Ü–∏—è.
  if(result && typeof result.reward==="number"){
    if(result.reward>0){ balance += result.reward; flash(t("win")(result.reward)); }
    else flash(t("lose")(result.answer ?? "?"));
  }else{
    const answer = Math.floor(Math.random()*9)+1;
    if(n===answer){
      const rewards=[1,2,3,5,7,10];
      const reward = rewards[Math.floor(Math.random()*rewards.length)];
      balance += reward;
      flash(t("win")(reward));
    }else{
      flash(t("lose")(answer));
    }
  }

  if(plays<=0) el.endModal.style.display="flex";
  saveLocal(); updateUI();
}

/* ====== AD FLOW ====== */
let adTimer=null, adElapsed=0;
function startAd(){
  el.adModal.style.display="flex";
  el.claimBtn.disabled = true;
  el.skipBtn.disabled = true;
  adElapsed=0; el.adFill.style.width="0%";

  adTimer = setInterval(()=>{
    adElapsed++;
    // 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–µ—Ä
    const pct = Math.min(100, Math.floor(adElapsed/30*100));
    el.adFill.style.width = pct+"%";
    if(adElapsed>=5) el.skipBtn.disabled = false; // skip —á–µ—Ä–µ–∑ 5 —Å–µ–∫
    if(adElapsed>=30){
      clearInterval(adTimer);
      el.claimBtn.disabled = false;
    }
  },1000);
}
function closeAd(claim){
  clearInterval(adTimer);
  el.adModal.style.display="none";
  if(claim){
    // –¥–∞—ë–º +10 –∏–≥—Ä
    plays += AD_GAIN_PLAYS;
    if(API && wallet) apiAdGain();
    saveLocal(); updateUI();
  }
}

/* ====== SHARE REWARD (1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏) ====== */
function canShareReward(){
  const k="t21_share_date";
  const last=localStorage.getItem(k);
  const today = new Date().toISOString().slice(0,10);
  if(last===today) return false;
  localStorage.setItem(k,today);
  return true;
}
function doShare(){
  if(!canShareReward()){ flash(t("shareOnce")); return; }
  // —Å–∏—Å—Ç–µ–º–Ω—ã–π share (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  const text="T21 Play Zone ‚Äî play & earn! üíé";
  try{
    if(navigator.share){ navigator.share({title:"T21 Play Zone", text, url:location.href}).catch(()=>{}); }
  }catch(_){}
  balance += SHARE_GAIN_T21;
  saveLocal(); updateUI();
  flash(`+${SHARE_GAIN_T21} T21`);
}

/* ====== EVENTS ====== */
el.lang.onchange = ()=>{ lang = el.lang.value; saveLocal(); applyLang(); updateUI(); }
el.saveBtn.onclick = ()=>{
  wallet = el.wallet.value.trim();
  saveLocal(); applyLang(); updateUI(); flash(t("saved")); apiState();
}
el.adBtn.onclick = ()=>{
  if(plays>0){ flash(t("adBlocked")); return; }
  startAd();
}
el.endAdBtn.onclick = ()=>{ el.endModal.style.display="none"; startAd(); }
el.withdrawBtn.onclick = ()=>{ flash("Soon"); }
el.skipBtn.onclick = ()=> closeAd(false);
el.claimBtn.onclick = ()=> closeAd(true);
el.shareBtn.onclick = doShare;

window.onload = ()=>{
  // init
  loadLocal();
  applyLang();
  el.wallet.value = wallet;
  updateUI();
  makeButtons();
  if(wallet) apiState();
}
</script>
</body>
</html>
